<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de Finan√ßas Pessoais</title>
    <style>
        /* Estilos anteriores mantidos */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .auth-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        #recaptcha-container {
            margin: 20px auto;
            text-align: center;
        }

        /* Restante dos estilos originais mantidos */
        /* ... [Todos os estilos CSS originais] ... */
    </style>
</head>
<body>
    <!-- Se√ß√£o de Autentica√ß√£o -->
    <div class="auth-container">
        <div class="form-card" id="cadastroForm">
            <h3>üìù Cadastrar Usu√°rio</h3>
            <form id="formCadastro">
                <div class="form-group">
                    <label for="emailCadastro">E-mail:</label>
                    <input type="email" id="emailCadastro" required>
                </div>
                <div class="form-group">
                    <label for="telefoneCadastro">Telefone:</label>
                    <input type="tel" id="telefoneCadastro" required>
                </div>
                <div class="form-group">
                    <label for="senhaCadastro">Senha:</label>
                    <input type="password" id="senhaCadastro" required>
                </div>
                <button type="submit" class="btn">Cadastrar</button>
            </form>
        </div>

        <div class="form-card" id="loginForm">
            <h3>üîë Login</h3>
            <form id="formLogin">
                <div class="form-group">
                    <label for="emailLogin">E-mail:</label>
                    <input type="email" id="emailLogin" required>
                </div>
                <div class="form-group">
                    <label for="senhaLogin">Senha:</label>
                    <input type="password" id="senhaLogin" required>
                </div>
                <button type="submit" class="btn">Entrar</button>
            </form>
        </div>

        <div class="form-card" id="recuperarSenhaForm">
            <h3>üîó Recuperar Senha</h3>
            <form id="formRecuperarSenha">
                <div class="form-group">
                    <label for="emailRecuperar">E-mail:</label>
                    <input type="email" id="emailRecuperar" required>
                </div>
                <button type="submit" class="btn">Enviar Link</button>
            </form>
        </div>
    </div>
    <div id="recaptcha-container"></div>

    <!-- Container principal original -->
    <div class="container">
        <!-- ... [Todo o conte√∫do original mantido] ... -->
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { 
            getFirestore, collection, addDoc, getDocs, deleteDoc, doc, onSnapshot 
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { 
            getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword,
            sendPasswordResetEmail, updateProfile, signInWithPhoneNumber, RecaptchaVerifier
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getAnalytics } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAWI5nE9xKqKMq44Z7clpmxh8mRg8UCV1w",
            authDomain: "gerenciadorfinancas2025.firebaseapp.com",
            projectId: "gerenciadorfinancas2025",
            storageBucket: "gerenciadorfinancas2025.firebasestorage.app",
            messagingSenderId: "577498996847",
            appId: "1:577498996847:web:16237723deb120eebeed9a",
            measurementId: "G-M8Q2GZYYWK"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const analytics = getAnalytics(app);

        class AuthManager {
            constructor() {
                this.configurarRecaptcha();
                this.configurarEventosAuth();
            }

            configurarRecaptcha() {
                window.recaptchaVerifier = new RecaptchaVerifier(
                    auth, 
                    'recaptcha-container', 
                    { 'size': 'invisible' }
                );
            }

            configurarEventosAuth() {
                document.getElementById('formCadastro').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const email = document.getElementById('emailCadastro').value;
                    const telefone = document.getElementById('telefoneCadastro').value;
                    const senha = document.getElementById('senhaCadastro').value;

                    try {
                        const userCredential = await createUserWithEmailAndPassword(auth, email, senha);
                        await updateProfile(userCredential.user, { displayName: telefone });
                        this.enviarVerificacaoTelefone(telefone);
                    } catch (error) {
                        console.error('Erro no cadastro:', error);
                    }
                });

                document.getElementById('formLogin').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const email = document.getElementById('emailLogin').value;
                    const senha = document.getElementById('senhaLogin').value;

                    try {
                        await signInWithEmailAndPassword(auth, email, senha);
                    } catch (error) {
                        console.error('Erro no login:', error);
                    }
                });

                document.getElementById('formRecuperarSenha').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const email = document.getElementById('emailRecuperar').value;

                    try {
                        await sendPasswordResetEmail(auth, email);
                        alert('Link de recupera√ß√£o enviado para seu e-mail!');
                    } catch (error) {
                        console.error('Erro ao enviar e-mail:', error);
                    }
                });
            }

            async enviarVerificacaoTelefone(telefone) {
                try {
                    const appVerifier = window.recaptchaVerifier;
                    await signInWithPhoneNumber(auth, telefone, appVerifier);
                    const codigo = prompt('Digite o c√≥digo SMS recebido:');
                    await confirmationResult.confirm(codigo);
                } catch (error) {
                    console.error('Erro na verifica√ß√£o do telefone:', error);
                }
            }
        }

        class GerenciadorFinancas {
            constructor() {
                this.transacoes = [];
                new AuthManager();
                this.inicializar();
                this.configurarListenerFirestore();
            }

            async inicializar() {
                try {
                    this.configurarEventos();
                    await this.carregarTransacoes();
                    this.mostrarStatus('Conectado ao Firebase!', 'success');
                    setTimeout(() => {
                        document.getElementById('connectionStatus').style.display = 'none';
                    }, 2000);
                } catch (error) {
                    console.error('Erro ao inicializar:', error);
                    this.mostrarStatus('Erro ao conectar com Firebase', 'error');
                }
            }

            // ... [M√©todos originais mantidos] ...
        }

        new GerenciadorFinancas();
    </script>
</body>
</html>
